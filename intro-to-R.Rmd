---
title: "Introduction to R, STAMPS 2024"
author: "Sarah Teichman"
date: "2024-07-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Organization

Welcome to R! The goal of this lesson is to level up your R skills, whether this is your first time using it or you're already a pro. This lesson is made up of five tutorials, each in a different .Rmd file within the "tutorials" folder. This document will be your guide, describing each tutorial and giving one or two practice questions for each topic. The tutorials build on each other, so start at the beginning if you're new to R, and if not then choose the first one with material new to you. We suggest that if you think you know the material from a tutorial, go through the exercises in this file anyway to shake the cobwebs off. 

## Tutorial 1: Data and data types

This tutorial provides an introduction to reading data into R and figuring out the basics about the dataset. It also contains an introduction to some of the basic data types in R (values, vectors, lists) and how to subset them. 

Exercises:

1. Read in the "covariates" data set in the "data" folder. How many observations are there? What is the name of the third variable in the dataset? 
```{r}

```

2. What is the third observation for the second variable in the "covariates" dataset? 
```{r}

```

## Tutorial 2: Using and writing functions

This tutorial describes what an R function is, how to figure out which arguments to use in a function, and how to write your own function. 

Exercises:

1. Randomly draw three values from the vector `covariates$SampleName` with the function `sample()`. Check out the documentation for this function by putting `?sample` in the console. Do this again including an additional argument that is not required for `sample()`. 

```{r}

```

2. Consider this function for calculating the centered log ratio (CLR) of a vector. 

```{r}
clr <- function(counts) {    
  transformed <- log(counts) - mean(log(counts))
  return(transformed)
}
```

Notice what happens when we include a $0$ in our vector `counts`.

```{r}
clr(c(1, 5, 4))
clr(c(1, 5, 0, 4))
```

Turns out we can't take the log of $0$! Rewrite this to include an optional argument `pseudo` that is set to $0.5$ by default, that will add this quantity to all $0$ values in the input `counts`.

```{r, eval = FALSE}
clr_with_pseudo <- function(counts, ) { # add optional argument
  new_counts <- counts
  new_counts[___] <- [____] # add pseudocounts to all 0 counts 
  transformed <- log(new_counts) - mean(log(new_counts))
  return(transformed)
}
```

## Tutorial 3: Phyloseq 

Phyloseq is an R package that can help you organize and manipulate microbiome data. A phyloseq object consists of three linked data tables that hold the sample data, otu data, and taxonomy data, for a specific data set. This tutorial introduces the structure of a phyloseq object, gives some examples of data manipulation and visualization with a phyloseq object, and shows you how to make your own. 

Exercises: Read in the `phyloseq` object below. Make a smaller `phyloseq` object that aggregates counts at the class level and only includes classes in the phylum *Cyanobacteria*. How many classes are remaining?

```{r}
phyloseq_obj <- readRDS("data/phyloseq_obj.rds")

```

## Tutorial 4: Data manipulation with the tidyverse

...

Exercises: 

## Tutorial 5: Plotting with the tidyverse 

...

Exercises:

## Optional bonus challenge!

Now that you have all of these R skills, you can work on putting them together to code more independently. The goal of this challenge is to make a different type of plot to show distances between samples that is not a PCoA plot. Specifically, we want to remake the plot below: 

```{r}
my_plot <- readRDS("figures/alternate_distance_plot.rds")
my_plot
```

In this plot, we have boxplots that represent the spread of Bray-Curtis distances between samples from different seasons, samples from summer, and samples from winter. You can use `phyloseq` to calculate the Bray-Curtis distances between samples, various functions from `dplyr` to organize your data, and `ggplot` to plot your data. 

If you'd like to decide how to proceed, try whatever you think could work! There are many ways to approach this task. If you'd like this task to be broken down into smaller pieces, you can use the outline below. 

1) Use the phyloseq object `phyloseq_obj` and the correct `phyloseq` function (check out the help files or do some Googling!) to calculate Bray-Curtis distances between points and extract the distance matrix.

2) From this distance matrix, extract small sub-matrices that include distances just for samples from the summer, just for samples from the winter, and distances between samples from the summer and samples from the winter. 

3) Turn each of these distance matrices into a vector, making sure not to double count distances (you want to count the distance between summer sample 1 and summer sample 2 once, although it appears in your distance matrix twice) and to remove distances between a sample and itself. 

4) Make a dataframe with one variable that holds the distances and one variable that holds the type of distance (is it a distance between two summer samples, a distance between two winter samples, or a distance between one summer and one winter sample?). 

5) Use that dataframe to make boxplots with ggplot. Make sure to include an interpretable y-axis label.
